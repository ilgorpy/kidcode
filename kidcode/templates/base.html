{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>KidCode</title>
    <link type="text/css" href="{% static 'mainapp/css/styles.css' %}" rel="stylesheet" />
    <script src="{% static 'mainapp/js/scripts.js' %}" defer></script>
</head>
<body>
           
            <div class="header">
                
                <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>

                <div id="sidebar">
                    <ul id="chapter-list"></ul>
                </div>

                <a href="{% url 'users:login'%}"><img src="{% static 'mainapp/images/pixel-last.png' %}" alt="logo" class = "logo"></a>
                <p class = "logo_name">KidCode</p>
                <div class =  "button-grid">
                {% if user.is_staff %}
                        {% for item in menu %}
                            <a href="{% url item.url_name %}" class="button">{{ item.title }}</a>
                        {% endfor %}
                {% else %}
                    {% for item in menu %}
                        {% if item.title == "Профиль" %}
                            <a href="{% url item.url_name %}" class="button">{{ item.title }}</a>
                        {% endif %}
                    {% endfor %}
                    
                {% endif %}
                </div>
                  
            </div>
        </div>
            
                {% block content %}
                
                {% endblock %}

                <script>
    document.addEventListener("DOMContentLoaded", function() {
        loadChapters(); // Загружаем главы при загрузке страницы
    });

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('active'); // Переключаем видимость боковой панели
    }

    function loadChapters() {
        fetch('/chapters/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const chapterList = document.getElementById('chapter-list');
                chapterList.innerHTML = ''; // Очищаем список перед добавлением новых элементов
                data.forEach(chapter => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.textContent = chapter;
                    a.href = '#';
                    a.onclick = () => loadLevels(chapter);

                    li.appendChild(a);
                    const ul = document.createElement('ul');
                    ul.className = 'dropdown';
                    ul.id = chapter;
                    ul.style.display = 'none';

                    li.appendChild(ul);


                    chapterList.appendChild(li);
                });
            })
            .catch(error => {
                console.error('Ошибка при загрузке глав:', error);
            });
    }

    function loadLevels(chapterName) {
        const dropdown = document.getElementById(chapterName);
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';

        // Если уровни еще не загружены, загружаем их
        if (dropdown.children.length === 0) {
            fetch(`/levels/${chapterName}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    data.forEach(level => {
                        const li = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = '#';
                        link.textContent = level; // Устанавливаем текст ссылки

                        li.appendChild(link); // Добавляем ссылку в элемент li
                        dropdown.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error('Ошибка при загрузке уровней:', error);
                });
        }
    }
</script>
                
            
</body>
</html>
